<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>HIERARQUIA DE ROTA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body{background:#000;color:#f5f5f5;font-family:Arial;margin:0}
header{background:#000;border-bottom:1px solid #333;padding:15px;text-align:center}
h1{margin:0;font-size:1.6rem}
main{max-width:1500px;margin:auto;padding:20px}

.card{background:#0a0a0a;border:1px solid #333;border-radius:10px;padding:20px;margin-bottom:20px}

button{padding:10px 16px;border-radius:6px;border:none;font-weight:bold;cursor:pointer}
.btn{background:#fff;color:#000}
.btn-danger{background:#444;color:#fff}

input,select{background:#0f0f0f;color:#fff;border:1px solid #444;padding:10px;border-radius:6px;width:100%}

table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{padding:10px;border-bottom:1px solid #333;font-size:14px}
th{background:#111}
tr:hover{background:#1a1a1a}

.badge{padding:6px 12px;border-radius:999px;font-weight:bold;background:#fff;color:#000}

.hidden{display:none}

.ativo{color:#22c55e;font-weight:bold}
.ausente{color:#facc15;font-weight:bold}
.inativo{color:#ef4444;font-weight:bold}

.status-indicator{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:5px}
.status-ativo{background:#22c55e}
.status-ausente{background:#facc15}
.status-inativo{background:#ef4444}

/* MODAL */
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center}
.modal-content{background:#0a0a0a;border:1px solid #333;padding:25px;border-radius:10px;width:320px;text-align:center}
</style>
</head>

<body>

<header>
<h1>ğŸ”’ HIERARQUIA DE ROTA</h1>
<button class="btn" onclick="abrirLogin()">ğŸ”‘ Acesso Administrativo</button>
<button id="logoutBtn" class="btn-danger hidden" onclick="logout()">ğŸšª Sair</button>
</header>

<main>

<div class="card">
<h2>ğŸ“Š Total Geral do Efetivo</h2>
<p style="font-size:32px;font-weight:bold" id="totalGeral">0</p>
</div>

<div id="adminPanel" class="card hidden">
<h2>ğŸ‘¥ Controle de Integrantes</h2>

<input id="nome" placeholder="Nome completo">
<br><br>

<select id="patente"></select>
<br><br>

<input type="date" id="entrada">
<br><br>

<select id="situacao">
<option value="ativo">Ativo</option>
<option value="ausente">Ausente</option>
<option value="inativo">Inativo</option>
</select>
<br><br>

<button class="btn" onclick="add()">Adicionar Integrante</button>
</div>

<div class="card">
<h2>ğŸ“‹ RelaÃ§Ã£o de Integrantes</h2>
<table>
<thead>
<tr>
<th>#</th><th>Nome</th><th>Patente</th><th>Entrada</th><th>SituaÃ§Ã£o</th><th>AÃ§Ã£o</th>
</tr>
</thead>
<tbody id="lista"></tbody>
</table>
</div>

<div class="card">
<h2>ğŸ“Œ DistribuiÃ§Ã£o por Categoria</h2>
<ul id="estatisticas" style="line-height:2"></ul>
</div>

</main>

<!-- MODAL LOGIN -->
<div id="loginModal" class="modal hidden">
<div class="modal-content">
<h3>ğŸ” ACESSO RESTRITO</h3>
<input type="password" id="senha" placeholder="Senha administrativa">
<br><br>
<button class="btn" type="button" onclick="login()">Entrar</button>
<br><br>
<button class="btn-danger" onclick="fecharLogin()">Cancelar</button>
</div>
</div>

<script>
const patentes = [
 {n:'Tenente-Coronel PM',o:1,c:'superior'},
 {n:'Major PM',o:2,c:'superior'},
 {n:'CapitÃ£o PM',o:3,c:'intermediario'},
 {n:'1Âº Tenente PM',o:4,c:'subalterno'},
 {n:'2Âº Tenente PM',o:5,c:'subalterno'},
 {n:'Aspirante PM',o:6,c:'especial'},
 {n:'Subtenente PM',o:7,c:'graduado'},
 {n:'1Âº Sargento PM',o:8,c:'graduado'},
 {n:'2Âº Sargento PM',o:9,c:'graduado'},
 {n:'3Âº Sargento PM',o:10,c:'graduado'},
 {n:'Cabo PM',o:11,c:'praca'},
 {n:'Soldado PM',o:12,c:'praca'}
];

let dados = JSON.parse(localStorage.getItem('hierarquia_rota')) || [];

function abrirLogin(){document.getElementById('loginModal').classList.remove('hidden')}
function fecharLogin(){document.getElementById('loginModal').classList.add('hidden')}

async function login(){
 const senha=document.getElementById('senha').value;
 if(!senha)return alert('Digite a senha');

 const res = await fetch('/api/login',{
  method:'POST',
  headers:{'Content-Type':'application/json'},
  body:JSON.stringify({senha})
 });

 if(res.ok){
  sessionStorage.setItem('admin','1');
  document.getElementById('adminPanel').classList.remove('hidden');
  document.getElementById('logoutBtn').classList.remove('hidden');
  fecharLogin();
 } else {
  alert('Senha incorreta');
 }
}

function logout(){
 sessionStorage.removeItem('admin');
 location.reload();
}

function init(){
 const sel=document.getElementById('patente');
 sel.innerHTML='<option value="">Selecione</option>';
 patentes.forEach(p=>{
  const o=document.createElement('option');
  o.value=p.n;o.textContent=p.n;
  sel.appendChild(o);
 });
 if(sessionStorage.getItem('admin')){
  document.getElementById('adminPanel').classList.remove('hidden');
  document.getElementById('logoutBtn').classList.remove('hidden');
 }
 render();
}

function add(){
 const nome=document.getElementById('nome').value.trim();
 const pat=document.getElementById('patente').value;
 if(!nome||!pat)return alert('Preencha os campos');
 const pObj=patentes.find(p=>p.n===pat);
 dados.push({
  id:Date.now(),nome,
  patente:pat,ordem:pObj.o,classe:pObj.c,
  entrada:document.getElementById('entrada').value,
  situacao:document.getElementById('situacao').value
 });
 localStorage.setItem('hierarquia_rota',JSON.stringify(dados));
 render();
}

function remover(i){
 if(confirm('Remover integrante?')){
  dados.splice(i,1);
  localStorage.setItem('hierarquia_rota',JSON.stringify(dados));
  render();
 }
}

function render(){
 dados.sort((a,b)=>a.ordem-b.ordem);
 document.getElementById('totalGeral').textContent=dados.length;
 const lista=document.getElementById('lista');
 lista.innerHTML='';
 const cont={praca:0,graduado:0,especial:0,subalterno:0,intermediario:0,superior:0};

 dados.forEach((d,i)=>{
  cont[d.classe]++;
  const st=d.situacao==='ativo'?'status-ativo':d.situacao==='ausente'?'status-ausente':'status-inativo';
  lista.innerHTML+=`
  <tr>
   <td>${i+1}</td>
   <td>${d.nome}</td>
   <td><span class="badge">${d.patente}</span></td>
   <td>${d.entrada||'-'}</td>
   <td class="${d.situacao}">
    <span class="status-indicator ${st}"></span>${d.situacao.toUpperCase()}
   </td>
   <td><button class="btn-danger" onclick="remover(${i})">X</button></td>
  </tr>`;
 });

 document.getElementById('estatisticas').innerHTML=`
 <li>PraÃ§as: ${cont.praca}</li>
 <li>PraÃ§as Graduadas: ${cont.graduado}</li>
 <li>PraÃ§as Especiais: ${cont.especial}</li>
 <li>Oficiais Subalternos: ${cont.subalterno}</li>
 <li>Oficiais IntermediÃ¡rios: ${cont.intermediario}</li>
 <li>Oficiais Superiores: ${cont.superior}</li>`;
}

init();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>HIERARQUIA DE ROTA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
/* ================= VISUAL PRETO COM BACKGROUND ================= */
body{
    background:#000 url('rota_copiar.png') no-repeat center center fixed;
    background-size: contain;
    color:#f5f5f5;
    font-family:Arial;
    margin:0;
    position: relative;
    min-height: 100vh;
}

/* Overlay escuro para melhor legibilidade */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: -1;
}

header{
    background:rgba(0,0,0,0.8);
    border-bottom:1px solid #333;
    padding:15px;
    text-align:center;
    position:relative;
    backdrop-filter: blur(5px);
}
h1{margin:0;font-size:1.6rem}
.card{
    background:rgba(10,10,10,0.85);
    border:1px solid #333;
    border-radius:10px;
    padding:20px;
    margin-bottom:20px;
    backdrop-filter: blur(5px);
}
main{
    max-width:1500px;
    margin:auto;
    padding:20px;
    position: relative;
    z-index: 1;
}

button{padding:10px 16px;border-radius:6px;border:none;font-weight:bold;cursor:pointer;transition:all 0.3s}
.btn{background:#fff;color:#000}
.btn:hover{background:#e0e0e0}
.btn-danger{background:#444;color:#fff}
.btn-danger:hover{background:#555}
.btn-success{background:#666;color:#fff}
.btn-success:hover{background:#777}
.btn-purple{background:#8b5cf6;color:#fff}
.btn-purple:hover{background:#7c3aed}
.btn-promover{background:#f59e0b;color:#000}
.btn-promover:hover{background:#d97706}
.btn-rebaixar{background:#6b7280;color:#fff}
.btn-rebaixar:hover{background:#4b5563}
.btn-status{background:#3b82f6;color:#fff}
.btn-status:hover{background:#1d4ed8}

input,select{
    background:rgba(15,15,15,0.9);
    color:#fff;
    border:1px solid #444;
    padding:10px;
    border-radius:6px;
    width:100%;
    margin-bottom:10px;
    box-sizing:border-box
}
input:focus,select:focus{outline:none;border-color:#888}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:15px;
    background:rgba(10,10,10,0.8);
}
th,td{
    padding:12px;
    border-bottom:1px solid rgba(51,51,51,0.8);
    text-align:left;
    font-size:14px;
}
th{
    background:rgba(17,17,17,0.9);
}
tr:hover{background:rgba(26,26,26,0.8)}

/* CORES DAS PATENTES CONFORME SOLICITADO */
.badge{
    padding:6px 12px;
    border-radius:999px;
    font-weight:bold;
    border:1px solid #000;
    display:inline-block;
    min-width:180px;
    text-align:center
}
.superior{background:#ffffff;color:#000000 !important;border:1px solid #aaa} /* BRANCO */
.intermediario{background:#22c55e;color:#000000 !important;border:1px solid #166534} /* VERDE */
.subalterno{background:#facc15;color:#000000 !important;border:1px solid #a16207} /* AMARELO */
.especial{background:#3b82f6;color:#ffffff !important;border:1px solid #1e40af} /* AZUL (MANTIDO) */
.graduado{background:#ef4444;color:#ffffff !important;border:1px solid #991b1b} /* VERMELHO */
.praca{background:#9ca3af;color:#000000 !important;border:1px solid #6b7280} /* CINZA */
.estagio{background:#a855f7;color:#ffffff !important;border:1px solid #7c3aed} /* ROXO - EST√ÅGIOS */

.hidden{display:none}

/* STATUS */
.ativo{color:#22c55e;font-weight:bold}
.ausente{color:#facc15;font-weight:bold}
.inativo{color:#ef4444;font-weight:bold}

.status-indicator{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:5px}
.status-ativo{background:#22c55e}
.status-ausente{background:#facc15}
.status-inativo{background:#ef4444}

/* CATEGORIAS COM CORES NAS LATERAIS */
.categoria-header{
    background:rgba(17,17,17,0.9);
    color:#fff;
    padding:10px 15px;
    margin-top:20px;
    border-left:4px solid #fff;
    font-weight:bold;
    font-size:1.2em;
    backdrop-filter: blur(5px);
}
.categoria-container{margin-bottom:30px}

/* CORES DAS BORDAS LATERAIS PARA CADA CATEGORIA */
.categoria-superior .categoria-header{border-left-color:#ffffff !important} /* BRANCO */
.categoria-intermediario .categoria-header{border-left-color:#22c55e !important} /* VERDE */
.categoria-subalterno .categoria-header{border-left-color:#facc15 !important} /* AMARELO */
.categoria-especial .categoria-header{border-left-color:#3b82f6 !important} /* AZUL */
.categoria-graduado .categoria-header{border-left-color:#ef4444 !important} /* VERMELHO */
.categoria-praca .categoria-header{border-left-color:#9ca3af !important} /* CINZA */
.categoria-estagio .categoria-header{border-left-color:#a855f7 !important} /* ROXO */

/* FORM GRID */
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;margin-bottom:20px}

/* TOTALS */
.totals-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:20px}
.total-card{
    background:rgba(17,17,17,0.85);
    padding:15px;
    border-radius:8px;
    text-align:center;
    border:2px solid transparent;
    transition:border-color 0.3s;
    backdrop-filter: blur(5px);
}
.total-card h3{margin:0 0 10px 0;color:#aaa;font-size:14px}
.total-card .numero{font-size:32px;font-weight:bold;color:#fff}

/* CORES DAS BORDAS PARA CADA CATEGORIA NO RESUMO GERAL */
.total-card.superior{border-color:#ffffff} /* BRANCO */
.total-card.intermediario{border-color:#22c55e} /* VERDE */
.total-card.subalterno{border-color:#facc15} /* AMARELO */
.total-card.especial{border-color:#3b82f6} /* AZUL */
.total-card.graduado{border-color:#ef4444} /* VERMELHO */
.total-card.praca{border-color:#9ca3af} /* CINZA */
.total-card.estagio{border-color:#a855f7} /* ROXO */

/* CORES DOS N√öMEROS PARA CADA CATEGORIA */
.total-card.superior .numero{color:#ffffff} /* BRANCO */
.total-card.intermediario .numero{color:#22c55e} /* VERDE */
.total-card.subalterno .numero{color:#facc15} /* AMARELO */
.total-card.especial .numero{color:#3b82f6} /* AZUL */
.total-card.graduado .numero{color:#ef4444} /* VERMELHO */
.total-card.praca .numero{color:#9ca3af} /* CINZA */
.total-card.estagio .numero{color:#a855f7} /* ROXO */

/* LOGIN MODAL */
.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.9)}
.modal-content{
    background:rgba(0,0,0,0.9);
    margin:15% auto;
    padding:30px;
    border-radius:10px;
    width:90%;
    max-width:400px;
    border:1px solid #333;
    backdrop-filter: blur(10px);
}
.modal h2{margin-top:0;color:#fff;text-align:center}
.close{color:#888;float:right;font-size:28px;font-weight:bold;cursor:pointer;line-height:1}
.close:hover{color:#fff}

/* NOVO REGISTRO */
.novo-registro{animation:highlight 2s ease-in-out}
@keyframes highlight{0%{background:rgba(255,255,255,0.1)}100%{background:transparent}}

/* CHECKBOX EST√ÅGIO */
.checkbox-container{display:flex;align-items:center;gap:10px;margin-top:10px}
.checkbox-container input[type="checkbox"]{width:20px;height:20px;margin:0}

/* A√á√ïES */
.acoes-container{display:flex;gap:5px;flex-wrap:wrap}
.acoes-container button{padding:6px 10px;font-size:12px}

</style>
</head>
<body>
<header>
<h1> HIERARQUIA DE ROTA </h1>
<button id="loginBtn" class="btn">üîë Acesso Administrativo</button>
<button id="logoutBtn" class="btn-danger hidden">üö™ Sair</button>
</header>

<main>
<!-- TOTAL GERAL -->
<div class="card">
<h2>üìä RESUMO GERAL DO EFETIVO</h2>
<div class="totals-grid">
<div class="total-card">
<h3>Total Geral</h3>
<div class="numero" id="totalGeral">0</div>
</div>
<div class="total-card superior">
<h3>Oficiais Superiores</h3>
<div class="numero" id="totalSuperiores">0</div>
</div>
<div class="total-card intermediario">
<h3>Oficiais Intermedi√°rios</h3>
<div class="numero" id="totalIntermediarios">0</div>
</div>
<div class="total-card subalterno">
<h3>Oficiais Subalternos</h3>
<div class="numero" id="totalSubalternos">0</div>
</div>
<div class="total-card especial">
<h3>Pra√ßas Especiais</h3>
<div class="numero" id="totalEspeciais">0</div>
</div>
<div class="total-card graduado">
<h3>Pra√ßas Graduadas</h3>
<div class="numero" id="totalGraduadas">0</div>
</div>
<div class="total-card praca">
<h3>Pra√ßas</h3>
<div class="numero" id="totalPracas">0</div>
</div>
<div class="total-card estagio">
<h3>Estagi√°rios</h3>
<div class="numero" id="totalEstagios">0</div>
</div>
</div>
</div>

<!-- MODAL DE LOGIN -->
<div id="loginModal" class="modal">
<div class="modal-content">
<span class="close">&times;</span>
<h2>üîê ACESSO RESTRITO</h2>
<input type="password" id="senha" placeholder="Senha de administrador" autocomplete="off" />
<button class="btn" id="btnEntrar" style="width:100%">VERIFICAR CREDENCIAIS</button>
</div>
</div>

<!-- PAINEL ADMIN -->
<div id="adminPanel" class="card hidden">
<h2>üë• CONTROLE DE INTEGRANTES</h2>
<div class="form-grid">
<div><label>CPF</label><input id="cpf" placeholder="000.000.000-00" /></div>
<div><label>NOME COMPLETO *</label><input id="nome" placeholder="Nome completo" /></div>
<div><label>PATENTE *</label><select id="patente"></select></div>
<div><label>FUN√á√ÉO</label><input id="funcao" placeholder="Cargo/Fun√ß√£o" /></div>
<div><label>DATA DE ENTRADA</label><input type="date" id="entrada" /></div>
<div><label>√öLTIMA PROMO√á√ÉO</label><input type="date" id="promocao" /></div>
<div><label>SITUA√á√ÉO</label><select id="situacao">
<option value="ativo">ATIVO</option>
<option value="ausente">AUSENTE</option>
<option value="inativo">INATIVO</option>
</select></div>
</div>

<!-- CHECKBOX PARA EST√ÅGIO -->
<div class="checkbox-container">
<input type="checkbox" id="estagio" />
<label for="estagio" style="font-weight:bold;color:#a855f7">üéì MARCAR COMO ESTAGI√ÅRIO</label>
</div>
<div style="margin:10px 0;padding:10px;background:rgba(26,26,26,0.8);border-radius:6px;border-left:4px solid #a855f7">
<small style="color:#d8b4fe;">‚ÑπÔ∏è Estagi√°rios aparecem na categoria especial "EST√ÅGIOS" abaixo de Pra√ßas.</small>
</div>

<br>
<button class="btn" onclick="add()">‚úÖ ADICIONAR INTEGRANTE</button>
<button class="btn-success" onclick="exportarDados()" style="margin-left:10px">üì• EXPORTAR DADOS</button>
<button class="btn-danger" onclick="limparForm()" style="margin-left:10px">üóëÔ∏è LIMPAR FORMUL√ÅRIO</button>
</div>

<!-- CATEGORIA: OFICIAIS SUPERIORES -->
<div class="categoria-container categoria-superior">
<div class="categoria-header">OFICIAIS SUPERIORES</div>
<div class="card">
<table>
<thead>
<tr>
<th>NOME</th>
<th>PATENTE</th>
<th>FUN√á√ÉO</th>
<th>ENTRADA</th>
<th>√öLTIMA PROMO√á√ÉO</th>
<th>SITUA√á√ÉO</th>
<th>A√á√ÉO</th>
</tr>
</thead>
<tbody id="lista-superiores"></tbody>
</table>
</div>
</div>

<!-- CATEGORIA: OFICIAIS INTERMEDI√ÅRIOS -->
<div class="categoria-container categoria-intermediario">
<div class="categoria-header">OFICIAIS INTERMEDI√ÅRIOS</div>
<div class="card">
<table>
<thead>
<tr>
<th>NOME</th>
<th>PATENTE</th>
<th>FUN√á√ÉO</th>
<th>ENTRADA</th>
<th>√öLTIMA PROMO√á√ÉO</th>
<th>SITUA√á√ÉO</th>
<th>A√á√ÉO</th>
</tr>
</thead>
<tbody id="lista-intermediarios"></tbody>
</table>
</div>
</div>

<!-- CATEGORIA: OFICIAIS SUBALTERNOS -->
<div class="categoria-container categoria-subalterno">
<div class="categoria-header">OFICIAIS SUBALTERNOS</div>
<div class="card">
<table>
<thead>
<tr>
<th>NOME</th>
<th>PATENTE</th>
<th>FUN√á√ÉO</th>
<th>ENTRADA</th>
<th>√öLTIMA PROMO√á√ÉO</th>
<th>SITUA√á√ÉO</th>
<th>A√á√ÉO</th>
</tr>
</thead>
<tbody id="lista-subalternos"></tbody>
</table>
</div>
</div>

<!-- CATEGORIA: PRA√áAS ESPECIAIS -->
<div class="categoria-container categoria-especial">
<div class="categoria-header">PRA√áAS ESPECIAIS</div>
<div class="card">
<table>
<thead>
<tr>
<th>NOME</th>
<th>PATENTE</th>
<th>FUN√á√ÉO</th>
<th>ENTRADA</th>
<th>√öLTIMA PROMO√á√ÉO</th>
<th>SITUA√á√ÉO</th>
<th>A√á√ÉO</th>
</tr>
</thead>
<tbody id="lista-especiais"></tbody>
</table>
</div>
</div>

<!-- CATEGORIA: PRA√áAS GRADUADAS -->
<div class="categoria-container categoria-graduado">
<div class="categoria-header">PRA√áAS GRADUADAS</div>
<div class="card">
<table>
<thead>
<tr>
<th>NOME</th>
<th>PATENTE</th>
<th>FUN√á√ÉO</th>
<th>ENTRADA</th>
<th>√öLTIMA PROMO√á√ÉO</th>
<th>SITUA√á√ÉO</th>
<th>A√á√ÉO</th>
</tr>
</thead>
<tbody id="lista-graduadas"></tbody>
</table>
</div>
</div>

<!-- CATEGORIA: PRA√áAS -->
<div class="categoria-container categoria-praca">
<div class="categoria-header">PRA√áAS</div>
<div class="card">
<table>
<thead>
<tr>
<th>NOME</th>
<th>PATENTE</th>
<th>FUN√á√ÉO</th>
<th>ENTRADA</th>
<th>√öLTIMA PROMO√á√ÉO</th>
<th>SITUA√á√ÉO</th>
<th>A√á√ÉO</th>
</tr>
</thead>
<tbody id="lista-pracas"></tbody>
</table>
</div>
</div>

<!-- CATEGORIA: EST√ÅGIOS -->
<div class="categoria-container categoria-estagio">
<div class="categoria-header">üéì EST√ÅGIOS</div>
<div class="card">
<table>
<thead>
<tr>
<th>NOME</th>
<th>PATENTE</th>
<th>FUN√á√ÉO</th>
<th>ENTRADA</th>
<th>√öLTIMA PROMO√á√ÉO</th>
<th>SITUA√á√ÉO</th>
<th>A√á√ÉO</th>
</tr>
</thead>
<tbody id="lista-estagios"></tbody>
</table>
</div>
</div>

</main>

<script>
// PATENTES COM S√çMBOLOS - ORDENADAS POR HIERARQUIA
const patentes = [
 // OFICIAIS SUPERIORES - BRANCO
 {n:'TENENTE-CORONEL PM ‚òÖ‚òÖ‚òÜ', o:1, c:'superior'},
 {n:'MAJOR PM ‚òÖ‚òÜ‚òÜ', o:2, c:'superior'},
 
 // OFICIAIS INTERMEDI√ÅRIOS - VERDE
 {n:'CAPIT√ÉO PM ‚òÜ‚òÜ‚òÜ', o:3, c:'intermediario'},
 
 // OFICIAIS SUBALTERNOS - AMARELO
 {n:'1¬∫ TENENTE PM ‚úß‚úß', o:4, c:'subalterno'},
 {n:'2¬∫ TENENTE PM ‚úß', o:5, c:'subalterno'},
 
 // PRA√áAS ESPECIAIS - AZUL
 {n:'ASPIRANTE PM ‚òÖ', o:6, c:'especial'},
 
 // PRA√áAS GRADUADAS - VERMELHO
 {n:'SUBTENENTE PM ‚ñ≥', o:7, c:'graduado'},
 {n:'1¬∫ SARGENTO PM ‚ü©‚ü©‚ü© ‚ü©‚ü©', o:8, c:'graduado'},
 {n:'2¬∫ SARGENTO PM ‚ü©‚ü©‚ü© ‚ü©', o:9, c:'graduado'},
 {n:'3¬∫ SARGENTO PM ‚ü©‚ü©‚ü©', o:10, c:'graduado'},
 
 // PRA√áAS - CINZA
 {n:'CABO PM ‚ü©‚ü©', o:11, c:'praca'},
 {n:'SOLDADO DE 1¬™ CLASSE PM ‚ü©', o:12, c:'praca'},  // NOVO: SOLDADO DE 1¬™ CLASSE
 {n:'SOLDADO DE 2¬™ CLASSE PM', o:13, c:'praca'}     // NOVO: SOLDADO DE 2¬™ CLASSE
];

let dados = JSON.parse(localStorage.getItem('hierarquia_rota')) || [];
let ultimoIdAdicionado = null;

function init(){
 const sel = document.getElementById('patente');
 sel.innerHTML = '<option value="">SELECIONE A PATENTE</option>';
 patentes.forEach(p => {
  const o = document.createElement('option');
  o.value = p.n;
  o.textContent = p.n;
  sel.appendChild(o);
 });
 
 // Configurar datas atuais
 const hoje = new Date().toISOString().split('T')[0];
 document.getElementById('entrada').value = hoje;
 document.getElementById('promocao').value = hoje;
 
 // Event listeners
 document.getElementById('loginBtn').onclick = openLoginModal;
 document.getElementById('logoutBtn').onclick = logout;
 document.getElementById('btnEntrar').onclick = login;
 document.querySelector('.close').onclick = closeLoginModal;
 
 // Fechar modal ao clicar fora
 window.onclick = function(event) {
  if (event.target == document.getElementById('loginModal')) {
   closeLoginModal();
  }
 };
 
 // Enter no campo de senha
 document.getElementById('senha').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') login();
 });
 
 // Verificar se j√° est√° logado
 checkLoginStatus();
 
 render();
}

function checkLoginStatus() {
 if (sessionStorage.getItem('logado') === '1') {
  document.getElementById('adminPanel').classList.remove('hidden');
  document.getElementById('loginBtn').classList.add('hidden');
  document.getElementById('logoutBtn').classList.remove('hidden');
 }
}

function openLoginModal() {
 document.getElementById('loginModal').style.display = 'block';
 document.getElementById('senha').focus();
}

function closeLoginModal() {
 document.getElementById('loginModal').style.display = 'none';
 document.getElementById('senha').value = '';
}

async function login() {
 const senha = document.getElementById('senha').value;

 if (!senha) {
  alert('DIGITE A SENHA');
  return;
 }

 try {
  const res = await fetch('/api/login', {
   method: 'POST',
   headers: { 'Content-Type': 'application/json' },
   body: JSON.stringify({ senha })
  });

  if (res.ok) {
   const data = await res.json();
   if (data.ok === true) {
    // Login bem-sucedido
    sessionStorage.setItem('logado', '1');
    
    document.getElementById('adminPanel').classList.remove('hidden');
    document.getElementById('loginBtn').classList.add('hidden');
    document.getElementById('logoutBtn').classList.remove('hidden');
    
    closeLoginModal();
    alert('‚úÖ ACESSO ADMINISTRATIVO CONCEDIDO');
   } else {
    alert('‚ùå SENHA INCORRETA');
   }
  } else {
   alert('‚ùå ERRO NA AUTENTICA√á√ÉO');
  }
 } catch (error) {
  alert('üî¥ ERRO DE CONEX√ÉO COM O SERVIDOR');
 }
 
 // Limpar campo
 document.getElementById('senha').value = '';
 document.getElementById('senha').focus();
}

function logout() {
 if (confirm('SAIR DO MODO ADMINISTRATIVO?')) {
  sessionStorage.removeItem('logado');
  location.reload();
 }
}

function limparForm() {
 document.getElementById('cpf').value = '';
 document.getElementById('nome').value = '';
 document.getElementById('funcao').value = '';
 const hoje = new Date().toISOString().split('T')[0];
 document.getElementById('entrada').value = hoje;
 document.getElementById('promocao').value = hoje;
 document.getElementById('situacao').value = 'ativo';
 document.getElementById('patente').value = '';
 document.getElementById('estagio').checked = false;
 document.getElementById('nome').focus();
}

function add() {
 const cpf = document.getElementById('cpf').value.trim();
 const nome = document.getElementById('nome').value.trim();
 const pat = document.getElementById('patente').value;
 const isEstagio = document.getElementById('estagio').checked;
 
 if (!nome || !pat) {
  alert('PREENCHA O NOME E A PATENTE');
  return;
 }
 
 const pObj = patentes.find(p => p.n === pat);
 if (!pObj) {
  alert('PATENTE INV√ÅLIDA');
  return;
 }
 
 const novoId = Date.now();
 const novoIntegrante = {
  id: novoId,
  cpf: cpf || 'N√ÉO INFORMADO',
  nome: nome,
  patente: pat,
  funcao: document.getElementById('funcao').value.trim() || 'N√ÉO DEFINIDA',
  ordem: pObj.o,
  classe: pObj.c, // Mant√©m a classe original da patente
  entrada: document.getElementById('entrada').value,
  promocao: document.getElementById('promocao').value || new Date().toISOString().split('T')[0],
  situacao: document.getElementById('situacao').value,
  dataCadastro: new Date().toISOString(),
  isEstagio: isEstagio // Flag para identificar estagi√°rio
 };
 
 dados.push(novoIntegrante);
 localStorage.setItem('hierarquia_rota', JSON.stringify(dados));
 
 // Marcar para highlight
 ultimoIdAdicionado = novoId;
 
 limparForm();
 render();
 
 const categoria = isEstagio ? 'EST√ÅGIOS' : 'REGULAR';
 alert(`‚úÖ ${nome.toUpperCase()} CADASTRADO COMO ${pat} - ${categoria}`);
}

function remover(i) {
 if (confirm('REMOVER ESTE INTEGRANTE?')) {
  dados.splice(i, 1);
  localStorage.setItem('hierarquia_rota', JSON.stringify(dados));
  render();
 }
}

// NOVA FUN√á√ÉO: ALTERAR STATUS DO INTEGRANTE
function alterarStatus(i) {
 const integrante = dados[i];
 
 // Alternar entre ATIVO e AUSENTE
 if (integrante.situacao === 'ativo') {
  integrante.situacao = 'ausente';
  localStorage.setItem('hierarquia_rota', JSON.stringify(dados));
  render();
  alert(`‚úÖ ${integrante.nome} marcado como AUSENTE`);
 } else if (integrante.situacao === 'ausente') {
  integrante.situacao = 'ativo';
  localStorage.setItem('hierarquia_rota', JSON.stringify(dados));
  render();
  alert(`‚úÖ ${integrante.nome} marcado como ATIVO`);
 } else {
  // Se estiver inativo, permite ativar
  integrante.situacao = 'ativo';
  localStorage.setItem('hierarquia_rota', JSON.stringify(dados));
  render();
  alert(`‚úÖ ${integrante.nome} reativado e marcado como ATIVO`);
 }
}

function toggleEstagio(i) {
 const integrante = dados[i];
 integrante.isEstagio = !integrante.isEstagio;
 localStorage.setItem('hierarquia_rota', JSON.stringify(dados));
 render();
 
 const acao = integrante.isEstagio ? 'marcado como ESTAGI√ÅRIO' : 'removido dos EST√ÅGIOS';
 alert(`${integrante.nome} ${acao}`);
}

// PROMOVER um integrante
function promover(i) {
 const integrante = dados[i];
 const indexAtual = patentes.findIndex(p => p.n === integrante.patente);
 
 if (indexAtual > 0) { // N√£o pode promover al√©m do topo
  const novaPatente = patentes[indexAtual - 1];
  integrante.patente = novaPatente.n;
  integrante.ordem = novaPatente.o;
  integrante.classe = novaPatente.c;
  integrante.promocao = new Date().toISOString().split('T')[0];
  
  localStorage.setItem('hierarquia_rota', JSON.stringify(dados));
  render();
  alert(`‚úÖ ${integrante.nome} PROMOVIDO para ${novaPatente.n}`);
 } else {
  alert('‚ö†Ô∏è Este j√° √© o mais alto posto!');
 }
}

// REBAIXAR um integrante
function rebaixar(i) {
 const integrante = dados[i];
 const indexAtual = patentes.findIndex(p => p.n === integrante.patente);
 
 if (indexAtual < patentes.length - 1) { // N√£o pode rebaixar al√©m do √∫ltimo
  const novaPatente = patentes[indexAtual + 1];
  integrante.patente = novaPatente.n;
  integrante.ordem = novaPatente.o;
  integrante.classe = novaPatente.c;
  integrante.promocao = new Date().toISOString().split('T')[0];
  
  localStorage.setItem('hierarquia_rota', JSON.stringify(dados));
  render();
  alert(`‚ö†Ô∏è ${integrante.nome} REBAIXADO para ${novaPatente.n}`);
 } else {
  alert('‚ö†Ô∏è Este j√° √© o posto mais baixo!');
 }
}

function exportarDados() {
 if (dados.length === 0) {
  alert('N√ÉO H√Å DADOS PARA EXPORTAR');
  return;
 }
 
 const dadosExportar = {
  sistema: 'HIERARQUIA DE ROTA',
  data: new Date().toISOString(),
  total: dados.length,
  integrantes: dados.map(d => ({
   cpf: d.cpf,
   nome: d.nome,
   patente: d.patente,
   funcao: d.funcao,
   entrada: d.entrada,
   promocao: d.promocao,
   situacao: d.situacao,
   categoria: d.classe,
   isEstagio: d.isEstagio || false
  }))
 };
 
 const dataStr = JSON.stringify(dadosExportar, null, 2);
 const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
 const fileName = `hierarquia-rota-${new Date().toISOString().split('T')[0]}.json`;
 
 const link = document.createElement('a');
 link.setAttribute('href', dataUri);
 link.setAttribute('download', fileName);
 link.click();
 
 alert('‚úÖ DADOS EXPORTADOS COM SUCESSO');
}

function render() {
 // Ordenar por hierarquia
 dados.sort((a, b) => a.ordem - b.ordem);
 
 // Totais gerais
 document.getElementById('totalGeral').textContent = dados.length;
 
 // Contadores por categoria
 const contadores = {
  estagio: 0,
  superior: 0,
  intermediario: 0,
  subalterno: 0,
  especial: 0,
  graduado: 0,
  praca: 0
 };
 
 dados.forEach(d => {
  // Contar por categoria real da patente
  if (contadores[d.classe] !== undefined) {
   contadores[d.classe]++;
  }
  // Contar estagi√°rios separadamente
  if (d.isEstagio) {
   contadores.estagio++;
  }
 });
 
 // Atualizar totais dos cards
 document.getElementById('totalSuperiores').textContent = contadores.superior;
 document.getElementById('totalIntermediarios').textContent = contadores.intermediario;
 document.getElementById('totalSubalternos').textContent = contadores.subalterno;
 document.getElementById('totalEspeciais').textContent = contadores.especial;
 document.getElementById('totalGraduadas').textContent = contadores.graduado;
 document.getElementById('totalPracas').textContent = contadores.praca;
 document.getElementById('totalEstagios').textContent = contadores.estagio;
 
 // Limpar todas as tabelas
 const tabelasIds = [
  'lista-superiores',
  'lista-intermediarios', 
  'lista-subalternos',
  'lista-especiais',
  'lista-graduadas',
  'lista-pracas',
  'lista-estagios'
 ];
 
 tabelasIds.forEach(id => {
  document.getElementById(id).innerHTML = '';
 });
 
 // Verificar se est√° logado
 const isLogado = sessionStorage.getItem('logado') === '1';
 
 // Preencher tabelas por categoria
 dados.forEach((d, i) => {
  const statusClass = d.situacao === 'ativo' ? 'status-ativo' : d.situacao === 'ausente' ? 'status-ausente' : 'status-inativo';
  
  const row = document.createElement('tr');
  row.setAttribute('data-id', d.id);
  
  // Adicionar classe de highlight se for o √∫ltimo adicionado
  if (d.id === ultimoIdAdicionado) {
   row.classList.add('novo-registro');
  }
  
  // Determinar a cor da badge
  // Estagi√°rios usam badge ROXO, outros mant√™m a cor normal
  const badgeClass = d.isEstagio ? 'estagio' : d.classe;
  
  // Determinar em qual tabela colocar
  let tabelaId;
  if (d.isEstagio) {
   // Estagi√°rios v√£o para a tabela especial
   tabelaId = 'lista-estagios';
  } else {
   // N√£o estagi√°rios v√£o para suas tabelas normais
   switch(d.classe) {
    case 'superior':
     tabelaId = 'lista-superiores';
     break;
    case 'intermediario':
     tabelaId = 'lista-intermediarios';
     break;
    case 'subalterno':
     tabelaId = 'lista-subalternos';
     break;
    case 'especial':
     tabelaId = 'lista-especiais';
     break;
    case 'graduado':
     tabelaId = 'lista-graduadas';
     break;
    case 'praca':
     tabelaId = 'lista-pracas';
     break;
    default:
     tabelaId = 'lista-pracas';
   }
  }
  
  // Verificar se pode promover/rebaixar
  const indexAtual = patentes.findIndex(p => p.n === d.patente);
  const podePromover = indexAtual > 0;
  const podeRebaixar = indexAtual < patentes.length - 1;
  
  // Determinar texto e √≠cone do bot√£o de status
  const statusBtnText = d.situacao === 'ativo' ? 'üìÖ AUSENTE' : d.situacao === 'ausente' ? '‚úÖ ATIVAR' : '‚úÖ ATIVAR';
  const statusBtnTitle = d.situacao === 'ativo' ? 'Marcar como AUSENTE' : d.situacao === 'ausente' ? 'Marcar como ATIVO' : 'Reativar como ATIVO';
  
  row.innerHTML = `
   <td style="font-weight:bold">${d.nome}</td>
   <td><span class="badge ${badgeClass}">${d.patente}</span></td>
   <td>${d.funcao}</td>
   <td>${d.entrada || '-'}</td>
   <td>${d.promocao || '-'}</td>
   <td class="${d.situacao}"><span class="status-indicator ${statusClass}"></span>${d.situacao.toUpperCase()}</td>
   <td>
    <div class="acoes-container">
    ${isLogado ? 
      `<button class="btn-danger" onclick="remover(${i})" title="Remover">üóëÔ∏è</button>
       ${podePromover ? `<button class="btn-promover" onclick="promover(${i})" title="Promover">‚¨ÜÔ∏è</button>` : ''}
       ${podeRebaixar ? `<button class="btn-rebaixar" onclick="rebaixar(${i})" title="Rebaixar">‚¨áÔ∏è</button>` : ''}
       <button class="btn-status" onclick="alterarStatus(${i})" title="${statusBtnTitle}">${statusBtnText}</button>
       ${!d.isEstagio ? `<button class="btn-purple" onclick="toggleEstagio(${i})" title="Mover para Est√°gios">üéì</button>` : `<button class="btn" onclick="toggleEstagio(${i})" title="Remover dos Est√°gios">üìã</button>`}` 
      : 'üîí'}
    </div>
   </td>
  `;
  
  document.getElementById(tabelaId).appendChild(row);
 });
 
 // Verificar login para mostrar/ocultar painel administrativo
 if (isLogado) {
  document.getElementById('adminPanel').classList.remove('hidden');
  document.getElementById('loginBtn').classList.add('hidden');
  document.getElementById('logoutBtn').classList.remove('hidden');
 } else {
  document.getElementById('adminPanel').classList.add('hidden');
  document.getElementById('loginBtn').classList.remove('hidden');
  document.getElementById('logoutBtn').classList.add('hidden');
 }
 
 // Remover highlight ap√≥s 2 segundos
 if (ultimoIdAdicionado) {
  setTimeout(() => {
   ultimoIdAdicionado = null;
   const rows = document.querySelectorAll('.novo-registro');
   rows.forEach(row => row.classList.remove('novo-registro'));
  }, 2000);
 }
}

// Inicializar
init();
</script>
</body>
</html>
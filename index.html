<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>HIERARQUIA DE ROTA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body{background:#000;color:#f5f5f5;font-family:Arial;margin:0}
header{background:#000;border-bottom:1px solid #333;padding:15px;text-align:center;position:relative}
h1{margin:0;font-size:1.6rem}
main{max-width:1500px;margin:auto;padding:20px}

.card{background:#0a0a0a;border:1px solid #333;border-radius:10px;padding:20px;margin-bottom:20px}

button{padding:10px 16px;border-radius:6px;border:none;font-weight:bold;cursor:pointer}
.btn{background:#fff;color:#000}
.btn-danger{background:#444;color:#fff}
.btn-success{background:#666;color:#fff}
.btn-purple{background:#8b5cf6;color:#fff}

input,select{background:#0f0f0f;color:#fff;border:1px solid #444;padding:10px;border-radius:6px;width:100%}

table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{padding:12px;border-bottom:1px solid #333;font-size:14px}
th{background:#111}

.hidden{display:none}

/* BADGES */
.badge{padding:6px 12px;border-radius:999px;font-weight:bold;display:inline-block}
.superior{background:#fff;color:#000}
.intermediario{background:#22c55e;color:#000}
.subalterno{background:#facc15;color:#000}
.especial{background:#3b82f6;color:#fff}
.graduado{background:#ef4444;color:#fff}
.praca{background:#9ca3af;color:#000}

/* STATUS */
.status-ativo{color:#22c55e}
.status-ausente{color:#facc15}
.status-inativo{color:#ef4444}

/* MODAL */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8)}
.modal-content{background:#000;margin:15% auto;padding:30px;border-radius:10px;max-width:400px}
.close{float:right;font-size:26px;cursor:pointer}

/* TOTALS */
.totals-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px}
.total-card{background:#111;padding:15px;border-radius:8px;text-align:center}
.total-card .numero{font-size:28px;font-weight:bold}

.categoria-header{background:#111;padding:10px;margin-top:20px;font-weight:bold}
</style>
</head>

<body>

<header>
<h1>HIERARQUIA DE ROTA</h1>
<button id="loginBtn" class="btn">üîë Acesso Administrativo</button>
<button id="logoutBtn" class="btn-danger hidden">üö™ Sair</button>
</header>

<main>

<!-- RESUMO -->
<div class="card">
<h2>üìä RESUMO GERAL</h2>
<div class="totals-grid">
<div class="total-card"><h3>Total</h3><div id="totalGeral" class="numero">0</div></div>
<div class="total-card"><h3>Superiores</h3><div id="totalSuperiores" class="numero">0</div></div>
<div class="total-card"><h3>Intermedi√°rios</h3><div id="totalIntermediarios" class="numero">0</div></div>
<div class="total-card"><h3>Subalternos</h3><div id="totalSubalternos" class="numero">0</div></div>
<div class="total-card"><h3>Pra√ßas</h3><div id="totalPracas" class="numero">0</div></div>
</div>
</div>

<!-- LOGIN -->
<div id="loginModal" class="modal">
<div class="modal-content">
<span class="close" onclick="closeLoginModal()">√ó</span>
<h2>üîê Login Administrativo</h2>
<input type="password" id="senha" placeholder="Senha" />
<button class="btn" onclick="login()" style="width:100%">Entrar</button>
</div>
</div>

<!-- ADMIN -->
<div id="adminPanel" class="card hidden">
<h2>üëÆ Painel Administrativo</h2>
<input id="nome" placeholder="Nome completo" />
<select id="patente"></select>
<button class="btn-success" onclick="add()">Adicionar</button>
</div>

<!-- LISTA -->
<div class="categoria-header">EFETIVO</div>
<div class="card">
<table>
<thead>
<tr>
<th>#</th>
<th>Nome</th>
<th>Patente</th>
<th>Status</th>
<th>A√ß√£o</th>
</tr>
</thead>
<tbody id="lista"></tbody>
</table>
</div>

</main>

<script>
const patentes = [
 {n:'TENENTE-CORONEL',c:'superior'},
 {n:'MAJOR',c:'superior'},
 {n:'CAPIT√ÉO',c:'intermediario'},
 {n:'TENENTE',c:'subalterno'},
 {n:'SARGENTO',c:'graduado'},
 {n:'SOLDADO',c:'praca'}
];

let dados = JSON.parse(localStorage.getItem('hierarquia_rota')) || [];

function init(){
 const sel = document.getElementById('patente');
 patentes.forEach(p=>{
  const o=document.createElement('option');
  o.value=p.n;o.textContent=p.n;
  sel.appendChild(o);
 });
 render();
}

function openLoginModal(){
 document.getElementById('loginModal').style.display='block';
}
function closeLoginModal(){
 document.getElementById('loginModal').style.display='none';
}

async function login(){
 const senha=document.getElementById('senha').value;
 const res=await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({senha})});
 if(res.ok){
  sessionStorage.setItem('logado','1');
  render();
  closeLoginModal();
 } else alert('Senha incorreta');
}

function logout(){
 sessionStorage.removeItem('logado');
 render();
}

function add(){
 const nome=document.getElementById('nome').value;
 const pat=document.getElementById('patente').value;
 if(!nome||!pat) return alert('Preencha tudo');
 const pObj=patentes.find(p=>p.n===pat);
 dados.push({nome,patente:pat,classe:pObj.c,status:'ativo'});
 localStorage.setItem('hierarquia_rota',JSON.stringify(dados));
 render();
}

function remover(i){
 if(confirm('Remover?')){
  dados.splice(i,1);
  localStorage.setItem('hierarquia_rota',JSON.stringify(dados));
  render();
 }
}

function render(){
 const tbody=document.getElementById('lista');
 tbody.innerHTML='';
 const isLogado=sessionStorage.getItem('logado')==='1';

 document.getElementById('adminPanel').classList.toggle('hidden',!isLogado);
 document.getElementById('loginBtn').classList.toggle('hidden',isLogado);
 document.getElementById('logoutBtn').classList.toggle('hidden',!isLogado);

 dados.forEach((d,i)=>{
  const tr=document.createElement('tr');
  tr.innerHTML=`
   <td>${i+1}</td>
   <td>${d.nome}</td>
   <td><span class="badge ${d.classe}">${d.patente}</span></td>
   <td class="status-${d.status}">${d.status}</td>
   <td>
    ${isLogado
      ? `<button class="btn-danger" onclick="remover(${i})">üóëÔ∏è</button>`
      : `<span style="color:#777">Somente admin</span>`}
   </td>`;
  tbody.appendChild(tr);
 });

 document.getElementById('totalGeral').textContent=dados.length;
}

document.getElementById('loginBtn').onclick=openLoginModal;
document.getElementById('logoutBtn').onclick=logout;
init();
</script>

</body>
</html>
